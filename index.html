<!DOCTYPE html>
<html lang="en">

<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>Web Synth</title>
  <link rel="stylesheet" href="src/styles.css">
</head>

<body>
  <main class="container">
    <header>
      <h1>Web Synth</h1>
      <button id="help-button" type="button" popovertarget="help-popover">Info</button>
    </header>

    <article class="instructions" id="help-popover" popover>
      <header>
        <h2>Instructions & Features</h2>
        <button type="button" popovertarget="help-popover" popovertargetaction="close">Close</button>
      </header>

      <p>
        This web-based synthesizer allows you to create and customize sounds using various synthesis parameters.
        You can play notes using the visual keyboard, your computer keyboard, or an external MIDI device. Adjust
        oscillators, envelopes, filters, LFOs, and effects to shape your sound. Use the recording feature to capture
        your creations and download them as audio files.
      </p>

      <p>
        Experiment with different settings to explore a wide range of sounds, from lush pads to punchy basses and
        soaring leads. The intuitive interface makes it easy to understand synthesis concepts while having fun
        creating music.
      </p>

      <h3>Sound Design Tips</h3>
      <ul>
        <li><strong>Pad Sound:</strong> 2-3 detuned saws (detune: ±10-20 cents), slow attack (0.5-1s), high sustain
          (70-90%), long release (1-2s), filter cutoff (1000-2000 Hz), LFO to filter (200-500 Hz, rate: 0.5-2 Hz)</li>
        <li><strong>Pluck/Bass:</strong> Fast attack (0.001-0.01s), short decay (0.1-0.3s), low sustain (0-30%), short
          release (0.1-0.3s), filter envelope amount (3000-5000 Hz), filter attack (0.001s), filter decay (0.2-0.4s)
        </li>
        <li><strong>Lead:</strong> 1-2 sawtooth waves, moderate filter cutoff (2000-4000 Hz), filter envelope amount
          (2000-4000 Hz), attack (0.01-0.05s), sustain (80-100%), pitch LFO for vibrato (5-15 cents, rate: 4-6 Hz)</li>
        <li><strong>Wobble Bass:</strong> Sawtooth, low filter cutoff (200-800 Hz), resonance (10-20), high LFO to
          filter with square wave (1000-3000 Hz, rate: 1-8 Hz), attack (0.001s), sustain (100%)</li>
        <li><strong>Space Effect:</strong> Long delay time (0.5-1s), high feedback (60-80%), moderate mix (20-40%)</li>
      </ul>

      <h3>Instrument Sounds</h3>
      <ul>
        <li><strong>Piano:</strong> 3 oscillators (sine 100%, triangle 60%, square 30%), attack (0.01s), decay
          (0.3-0.5s), sustain (60-80%), release (0.2-0.4s), filter cutoff (5000-8000 Hz)</li>
        <li><strong>Organ:</strong> 2-3 square waves (100%, 70%, 50%), no filter envelope, slow attack (0.1-0.3s),
          sustain (100%), release (0.1s), filter cutoff (8000-12000 Hz)</li>
        <li><strong>Strings:</strong> 2 detuned sawtooths (detune: ±8-15 cents, both 100%), slow attack (1-2s), sustain
          (90-100%), long release (1.5-2.5s), filter cutoff (2000-4000 Hz), delay time (0.4-0.6s), delay mix (15-25%)
        </li>
        <li><strong>Bass Guitar:</strong> 1-2 sawtooths (100%, 60%), fast attack (0.005-0.01s), short decay (0.2-0.4s),
          sustain (30-50%), release (0.1-0.2s), filter cutoff (800-1500 Hz), filter envelope amount (500-1000 Hz)</li>
        <li><strong>Flute:</strong> Sine wave (100%), moderate attack (0.1-0.2s), sustain (80-90%), release (0.3-0.5s),
          filter cutoff (3000-5000 Hz), pitch LFO (3-8 cents, rate: 4-5 Hz)</li>
        <li><strong>Brass:</strong> 2 sawtooths (100%, 80%), attack (0.05-0.1s), sustain (90-100%), release (0.2-0.4s),
          filter cutoff (2500-4000 Hz), filter envelope amount (2000-3000 Hz), resonance (3-6)</li>
        <li><strong>Electric Piano:</strong> Sine + triangle (100%, 70%), attack (0.01s), decay (0.5-1s), sustain
          (40-60%), release (0.3-0.5s), filter cutoff (6000-10000 Hz), slight delay (time: 0.15s, mix: 10-15%)</li>
      </ul>
    </article>

    <section class="module" id="master-controls">
      <header>
        <h2>Master Controls</h2>
        <button type="button" popovertarget="master-instructions">Instructions</button>
      </header>

      <article class="instructions" id="master-instructions" popover>
        <header>
          <h3>Master Controls</h3>
          <button type="button" popovertarget="master-instructions" popovertargetaction="close">Close</button>
        </header>

        <p>
          Master controls affect the overall synthesizer output and recording functionality, allowing you to save your
          creations as audio files for sharing or further editing.
        </p>

        <ul>
          <li><strong>Polyphonic:</strong> Toggle between polyphonic (multiple notes) and monophonic (single note)
            modes</li>
          <li><strong>Master Volume:</strong> Overall output volume control (0 - 100%)</li>
          <li><strong>Start Recording:</strong> Click the "Start Recording" button to begin capturing audio output</li>
          <li><strong>Stop Recording:</strong> Click the button again (now "Stop Recording") to end the recording
            session</li>
          <li><strong>Download:</strong> After stopping, a download link will appear to save the recorded audio as a
            .webm file</li>
        </ul>
      </article>

      <div class="controls">
        <toggle-switch id="poly" label-on="Polyphony: On" label-off="Polyphony: Off" checked></toggle-switch>

        <range-control label="Master Volume" id="master-volume" min="0" max="1" step="0.01" value="0.3" formatter="%">
        </range-control>

        <button id="record">Start Recording</button>
      </div>
    </section>

    <section class="module" id="visual-keyboard">
      <header>
        <h2>Visual Keyboard</h2>
        <button type="button" popovertarget="keyboard-instructions">Instructions</button>
      </header>
      <piano-keyboard id="keyboard-upper" octave="5" keys="qwertyu,23567"></piano-keyboard>

      <piano-keyboard id="keyboard-lower" octave="4" keys="zxcvbnm,sdghj"></piano-keyboard>

      <div class="controls">
        <octave-picker id="octave-upper" label="Upper Octave" value="5" min="3" max="6"></octave-picker>

        <octave-picker id="octave-lower" label="Lower Octave" value="4" min="2" max="5"></octave-picker>

        <toggle-switch id="midi-enabled" label-on="MIDI: Connected" label-off="MIDI: Disabled"></toggle-switch>
      </div>

      <article class="instructions" id="keyboard-instructions" popover>
        <header>
          <h3>Playing Notes</h3>
          <button type="button" popovertarget="keyboard-instructions" popovertargetaction="close">Close</button>
        </header>

        <p>
          You can play notes using the visual keyboard, your computer keyboard, or an external MIDI device.
        </p>

        <ul>
          <li><strong>Keyboard:</strong> Use your computer keyboard to play notes
            <ul>
              <li>Lower octave white keys: Z, X, C, V, B, N, M (C-B)</li>
              <li>Lower octave black keys: S, D, G, H, J (sharps/flats)</li>
              <li>Upper octave white keys: Q, W, E, R, T, Y, U (C-B)</li>
              <li>Upper octave black keys: 2, 3, 5, 6, 7 (sharps/flats)</li>
            </ul>
          </li>
          <li><strong>Mouse/Touch:</strong> Click or tap any key on the visual keyboard</li>
          <li><strong>Upper/Lower Octave:</strong> Use the dropdowns to change the octave of each keyboard</li>
          <li><strong>MIDI:</strong> Enable MIDI to use an external MIDI keyboard or controller</li>
        </ul>
      </article>
    </section>

    <section class="module" id="oscillator-controls">
      <header>
        <h2>Oscillators</h2>
        <button type="button" popovertarget="oscillator-instructions">Instructions</button>
      </header>

      <article class="instructions" id="oscillator-instructions" popover>
        <header>
          <h3>Oscillators</h3>
          <button type="button" popovertarget="oscillator-instructions" popovertargetaction="close">Close</button>
        </header>

        <p>
          Oscillators are the primary sound sources in the synthesizer. You can add multiple oscillators to layer
          sounds and create richer tones.
        </p>

        <ul>
          <li><strong>Multiple Oscillators:</strong> Add multiple oscillators to layer and create richer sounds</li>
          <li><strong>Waveform:</strong> Choose between Sine (smooth), Square (hollow), Sawtooth (bright), or Triangle
            (mellow)</li>
          <li><strong>Detune:</strong> Adjust frequency offset (-1200 to +1200 cents) for chorus and unison effects</li>
          <li><strong>Level:</strong> Control the volume/mix of each oscillator (0-100%)</li>
        </ul>
      </article>

      <div id="oscillator-list" class="oscillator-list"></div>
      <button id="add-oscillator">Add Oscillator</button>
    </section>

    <section class="module" id="asdr-module">
      <header>
        <h2>Amplitude Envelope (ADSR)</h2>
        <button type="button" popovertarget="adsr-instructions">Instructions</button>
      </header>

      <article class="instructions" id="adsr-instructions" popover>
        <header>
          <h3>Amplitude Envelope (ADSR)</h3>
          <button type="button" popovertarget="adsr-instructions" popovertargetaction="close">Close</button>
        </header>

        <p>
          The amplitude envelope shapes the volume of the sound over time using four stages: Attack, Decay, Sustain,
          and Release.
        </p>

        <ul>
          <li><strong>Attack:</strong> How quickly the note reaches full volume (0.001s - 2s)</li>
          <li><strong>Decay:</strong> How quickly it falls to sustain level after attack</li>
          <li><strong>Sustain:</strong> The held volume level while note is pressed (0-100%)</li>
          <li><strong>Release:</strong> How quickly the note fades after release (0.01s - 3s)</li>
        </ul>
      </article>

      <div class="controls">
        <range-control label="Attack" id="attack" min="0.001" max="2" step="0.001" value="0.01" formatter="seconds">
        </range-control>

        <range-control label="Decay" id="decay" min="0.001" max="2" step="0.001" value="0.01" formatter="seconds">
        </range-control>

        <range-control label="Sustain" id="sustain" min="0" max="1" step="0.01" value="0.7" formatter="percentage">
        </range-control>

        <range-control label="Release" id="release" min="0.01" max="3" step="0.01" value="0.5" formatter="seconds">
        </range-control>
      </div>
    </section>

    <section class="module" id="filter-module">
      <header>
        <h2>Filter</h2>
        <button type="button" popovertarget="filter-instructions">Instructions</button>
      </header>

      <article class="instructions" id="filter-instructions" popover>
        <header>
          <h3>Filter</h3>
          <button type="button" popovertarget="filter-instructions" popovertargetaction="close">Close</button>
        </header>

        <p>
          The filter shapes the tonal quality of the sound by cutting off frequencies above a certain point. You can
          adjust the cutoff frequency, resonance, and how the filter envelope modulates the cutoff over time.
        </p>

        <ul>
          <li><strong>Cutoff:</strong> Frequency where filter starts cutting (20Hz - 20kHz). Lower = darker sound</li>
          <li><strong>Resonance:</strong> Emphasis at cutoff frequency (0.1 - 30). Higher = more pronounced peak</li>
          <li><strong>Envelope Amount:</strong> How much the filter envelope modulates cutoff (0 - 10000 Hz)</li>
          <li><strong>Filter Envelope:</strong> Separate ADSR for filter cutoff modulation over time</li>
        </ul>
      </article>

      <div class="controls">
        <range-control label="Cutoff" id="filter-cutoff" min="20" max="20000" step="1" value="2000">
        </range-control>

        <range-control label="Resonance" id="filter-resonance" min="0.1" max="30" step="0.1" value="1">
        </range-control>

        <range-control label="Envelope Amount" id="filter-env-amount" min="0" max="10000" step="10" value="2000">
        </range-control>
      </div>

      <h3>Filter Envelope</h3>
      <div class="controls">
        <range-control label="Attack" id="filter-attack" min="0.001" max="2" step="0.001" value="0.1">
        </range-control>

        <range-control label="Decay" id="filter-decay" min="0.001" max="2" step="0.001" value="0.3">
        </range-control>

        <range-control label="Sustain" id="filter-sustain" min="0" max="1" step="0.01" value="0.5">
        </range-control>

        <range-control label="Release" id="filter-release" min="0.01" max="3" step="0.01" value="0.5">
        </range-control>
      </div>
    </section>

    <section class="module" id="lfo-module">
      <header>
        <h2>LFO (Modulation)</h2>
        <button type="button" popovertarget="lfo-instructions">Instructions</button>
      </header>

      <article class="instructions" id="lfo-instructions" popover>
        <header>
          <h3>LFO (Low Frequency Oscillator)</h3>
          <button type="button" popovertarget="lfo-instructions" popovertargetaction="close">Close</button>
        </header>

        <p>
          The LFO modulates parameters like filter cutoff and pitch to add movement and variation to the sound.
        </p>

        <ul>
          <li><strong>Waveform:</strong> Shape of the modulation wave</li>
          <li><strong>Rate:</strong> Speed of modulation (0.1 - 20 Hz)</li>
          <li><strong>To Filter:</strong> Amount of filter cutoff wobble (0 - 5000 Hz)</li>
          <li><strong>To Pitch:</strong> Amount of pitch vibrato (0 - 100 cents)</li>
        </ul>
      </article>

      <div class="controls">
        <waveform-picker id="lfo-waveform" label="Waveform" value="sine"></waveform-picker>

        <range-control label="Rate" id="lfo-rate" min="0.1" max="20" step="0.1" value="5" formatter="hertz">
        </range-control>

        <range-control label="To Filter" id="lfo-to-filter" min="0" max="5000" step="10" value="0" formatter="hertz">
        </range-control>

        <range-control label="To Pitch" id="lfo-to-pitch" min="0" max="100" step="1" value="0" formatter="cents">
        </range-control>
      </div>
    </section>

    <section class="module" id="delay-effect">
      <header>
        <h2>Delay Effect</h2>
        <button type="button" popovertarget="delay-instructions">Instructions</button>
      </header>

      <article class="instructions" id="delay-instructions" popover>
        <header>
          <h3>Delay Effect</h3>
          <button type="button" popovertarget="delay-instructions" popovertargetaction="close">Close</button>
        </header>

        <p>
          The delay effect creates echoes of the sound, adding depth and space to your audio.
        </p>

        <ul>
          <li><strong>Time:</strong> Delay time in seconds (0 - 2s)</li>
          <li><strong>Feedback:</strong> How much the delay repeats (0 - 95%)</li>
          <li><strong>Mix:</strong> Balance between dry (original) and wet (delayed) signal (0 - 100%)</li>
        </ul>
      </article>

      <div class="controls">
        <range-control label="Time" id="delay-time" min="0" max="2" step="0.01" value="0.375" formatter="s">
        </range-control>

        <range-control label="Feedback" id="delay-feedback" min="0" max="0.95" step="0.01" value="0.3" formatter="%">
        </range-control>

        <range-control label="Mix" id="delay-mix" min="0" max="1" step="0.01" value="0.2" formatter="%">
        </range-control>
      </div>
    </section>
  </main>

  <script type="module" src="src/main.ts"></script>
</body>

</html>